# Cloudflare Multi-Worker Boilerplate

A modern, production-ready boilerplate for building full-stack applications with Cloudflare Workers and Durable Objects. This template provides a solid foundation for developing scalable, serverless applications on the Cloudflare platform.

## Features

- 🚀 Monorepo structure for multiple workers and durable objects
- ⚡️ React Router for the web application
- 📦 TypeScript support across all packages
- 🔄 Pre-configured scripts for typegen and deployment
- 🔒 Environment variable management

- 🧩 Durable Objects for stateful applications
- 🔍 Zod for schema validation
- 🎨 TailwindCSS for styling

## Technologies

### Core Technologies

- **[Cloudflare Workers](https://developers.cloudflare.com/workers/)**: Serverless JavaScript runtime at the edge
- **[Cloudflare Durable Objects](https://developers.cloudflare.com/durable-objects/)**: Stateful serverless objects for coordination and persistence


### Frontend

- **[React](https://react.dev/)**: UI library for building component-based interfaces
- **[React Router](https://reactrouter.com/)**: Declarative routing for React applications
- **[TailwindCSS](https://tailwindcss.com/)**: Utility-first CSS framework

### Validation

- **[Zod](https://zod.dev/)**: TypeScript-first schema validation

### Monorepo Management

- **[Turborepo](https://turborepo.com/)**: High-performance build system for JavaScript/TypeScript monorepos
- **[Bun](https://bun.sh/)**: Fast JavaScript runtime, bundler, test runner, and package manager

## Project Structure

```
cf-multiworker-boilerplate/
├── apps/                  # Web applications
│   └── web/               # Main web application (React Router)
│       ├── app/           # React application code
│       │   ├── components/# React components
│       │   ├── routes/    # Route components
│       │   └── welcome/   # Welcome page assets
│       └── workers/       # Worker entry points
├── durable-objects/       # Durable Objects
│   └── example-do/        # Example Durable Object
├── scripts/               # Utility scripts
│   ├── post-typegen.ts    # Script to fix Durable Object type imports
│   └── predeploy.ts       # Pre-deployment script
└── turbo.json             # Turborepo configuration
```

### Custom Configuration Scripts

The project includes custom scripts to streamline development and deployment:

#### post-typegen.ts

This script automatically fixes Durable Object type definitions after Wrangler generates them:

- Parses type comments generated by Wrangler (e.g., `/* ExampleDo from cf-example-do */`)
- Resolves the correct import path to the Durable Object implementation
- Replaces the comment with proper TypeScript import syntax for full type safety
- Runs automatically after `wrangler types` via the `cf-typegen` script
- Uses `jsonc-parser` for proper JSONC handling

This approach ensures you get full TypeScript type safety for cross-worker Durable Object bindings without needing to manually re-export classes.

## Getting Started

### Prerequisites

- [Bun](https://bun.sh/) (>= 1.2.20)
- [Node.js](https://nodejs.org/) (>= 18)
- [Cloudflare Account](https://dash.cloudflare.com/sign-up)

### Creating a New Project from This Template

To create a new project based on this template using the GitHub CLI:

```bash
gh repo create [repo_name_here] --template firtoz/cf-multiworker-boilerplate [--private]
cd [repo_name_here]
```

Replace `[repo_name_here]` with your desired repository name. The repository will be public by default; add `--private` if you want it to be private.

### Installation

Install the dependencies:

```bash
bun install
```

### Environment Setup

Create a `.env.local` file in the root directory with your Cloudflare credentials:

```
CLOUDFLARE_API_TOKEN=your_api_token
CLOUDFLARE_ACCOUNT_ID=your_account_id
SESSION_SECRET=your_session_secret
VALUE_FROM_CLOUDFLARE=example_value
```

For the web application, copy the example environment variables:

```bash
cd apps/web
cp .env.example .env
```

### Development

Start the development server:

```bash
bun run dev
```

This will start all the necessary services for development.

## Deployment

### Configuration

Before deploying, you need to configure your wrangler.jsonc files with your Cloudflare account details:

#### 1. Configure Durable Objects

The Durable Objects are already configured in the wrangler files, but you need to ensure that the `script_name` in the web app matches the name of your Durable Object worker:

- In `apps/web/wrangler.jsonc`, make sure the `script_name` in the Durable Object binding matches your Durable Object worker name:

```jsonc
"durable_objects": {
  "bindings": [
    {
      "name": "ExampleDo",
      "class_name": "ExampleDo",
      "script_name": "cf-example-do" // This should match the name in durable-objects/example-do/wrangler.jsonc
    }
  ]
}
```

### Deploying

Once configured, deploy all services to Cloudflare:

```bash
bun run deploy
```

This will deploy both the web application and the Durable Object to your Cloudflare account.

## Customizing the Boilerplate

### Adding a New Durable Object

1. Create a new directory in `durable-objects/`
2. Copy the structure from `example-do/`
3. Update the package.json and wrangler.jsonc files
4. Implement your Durable Object logic in `workers/app.ts`

### Adding a New Web Application

1. Create a new directory in `apps/`
2. Copy the structure from `web/`
3. Update the package.json and wrangler.jsonc files
4. Implement your web application

## Scripts

- `post-typegen.ts`: Fixes Durable Object type imports after Wrangler type generation
  - Parses type comments generated by Wrangler
  - Resolves correct import paths to Durable Object implementations
  - Ensures full TypeScript type safety for cross-worker bindings

- `predeploy.ts`: Prepares the project for deployment to Cloudflare

## License

MIT
